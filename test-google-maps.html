<!DOCTYPE html>
<html>

<head>
    <title>Google Maps API Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .success {
            border-color: #4CAF50;
            background: #f1f8e9;
        }

        .error {
            border-color: #f44336;
            background: #ffebee;
        }

        .warning {
            border-color: #ff9800;
            background: #fff3e0;
        }

        #map {
            height: 400px;
            width: 100%;
            border: 1px solid #ccc;
            margin-top: 10px;
        }

        input {
            width: 60%;
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            padding: 8px 16px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #1976D2;
        }

        .log {
            background: #263238;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üó∫Ô∏è Google Maps API Tester</h1>
        <p>This tool helps you test if your Google Maps API key is working correctly.</p>

        <div class="test-section">
            <h3>1. API Key Test</h3>
            <input type="text" id="apiKeyInput" placeholder="Enter your Google Maps API key here..." />
            <button onclick="testApiKey()">Test API Key</button>
            <div id="keyTestResult"></div>
        </div>

        <div class="test-section">
            <h3>2. API Loading Test</h3>
            <button onclick="testApiLoading()">Load Google Maps API</button>
            <div id="loadTestResult"></div>
            <div class="log" id="loadingLog" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>3. Map Initialization Test</h3>
            <button onclick="testMapInit()">Initialize Map</button>
            <div id="mapTestResult"></div>
            <div id="map"></div>
        </div>

        <div class="test-section">
            <h3>4. Current Environment</h3>
            <div id="envInfo"></div>
        </div>
    </div>

    <script>
        let currentApiKey = '';
        let mapInstance = null;

        function log(message, level = 'info') {
            const logEl = document.getElementById('loadingLog');
            logEl.style.display = 'block';
            const timestamp = new Date().toLocaleTimeString();
            const color = level === 'error' ? '#ff5722' : level === 'warning' ? '#ff9800' : '#4caf50';
            logEl.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }

        function updateResult(elementId, message, type = 'info') {
            const el = document.getElementById(elementId);
            el.className = 'test-section ' + type;
            el.innerHTML = `<strong>Result:</strong> ${message}`;
        }

        function testApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();

            if (!apiKey) {
                updateResult('keyTestResult', 'Please enter an API key to test', 'error');
                return;
            }

            if (!apiKey.startsWith('AIza') || apiKey.length < 30) {
                updateResult('keyTestResult', 'This doesn\'t look like a valid Google Maps API key (should start with "AIza" and be ~39 characters long)', 'warning');
                return;
            }

            currentApiKey = apiKey;
            updateResult('keyTestResult', `‚úÖ API key format looks correct: ${apiKey.substring(0, 10)}...`, 'success');

            // Test the key with a simple API call
            testApiValidation(apiKey);
        }

        function testApiValidation(apiKey) {
            log('Testing API key validation...', 'info');

            // Test with Geocoding API (simpler than Maps JavaScript API)
            const testUrl = `https://maps.googleapis.com/maps/api/geocode/json?address=1600+Amphitheatre+Parkway,+Mountain+View,+CA&key=${apiKey}`;

            fetch(`https://cors-anywhere.herokuapp.com/${testUrl}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'OK') {
                        log('‚úÖ API key validation successful!', 'info');
                        updateResult('keyTestResult', '‚úÖ API key is valid and working!', 'success');
                    } else {
                        log(`‚ùå API validation failed: ${data.status} - ${data.error_message || 'Unknown error'}`, 'error');
                        updateResult('keyTestResult', `‚ùå API key validation failed: ${data.status}`, 'error');
                    }
                })
                .catch(error => {
                    log('‚ö†Ô∏è Could not test API key directly (CORS issues), but will try loading Maps API...', 'warning');
                    updateResult('keyTestResult', '‚ö†Ô∏è Direct validation blocked by CORS, will test with Maps API', 'warning');
                });
        }

        function testApiLoading() {
            if (!currentApiKey) {
                updateResult('loadTestResult', 'Please test an API key first', 'error');
                return;
            }

            log('Attempting to load Google Maps JavaScript API...', 'info');

            // Remove any existing Google Maps scripts
            const existingScript = document.querySelector('script[src*="maps.googleapis.com"]');
            if (existingScript) {
                existingScript.remove();
                log('Removed existing Google Maps script', 'info');
            }

            // Create new script element
            const script = document.createElement('script');
            script.async = true;
            script.defer = true;
            script.src = `https://maps.googleapis.com/maps/api/js?key=${currentApiKey}&callback=onMapsApiLoaded`;

            script.onerror = function () {
                log('‚ùå Failed to load Google Maps API script', 'error');
                updateResult('loadTestResult', '‚ùå Failed to load Google Maps API', 'error');
            };

            // Add global callback
            window.onMapsApiLoaded = function () {
                log('‚úÖ Google Maps API loaded successfully!', 'info');
                updateResult('loadTestResult', '‚úÖ Google Maps API loaded successfully!', 'success');

                // Test if google.maps is available
                if (typeof google !== 'undefined' && google.maps) {
                    log('‚úÖ google.maps object is available', 'info');
                } else {
                    log('‚ùå google.maps object is not available', 'error');
                }
            };

            document.head.appendChild(script);
            log('Google Maps API script added to page', 'info');

            // Set timeout for loading
            setTimeout(() => {
                if (typeof google === 'undefined' || !google.maps) {
                    log('‚ùå Google Maps API failed to load within 10 seconds', 'error');
                    updateResult('loadTestResult', '‚ùå API loading timeout (10 seconds)', 'error');
                }
            }, 10000);
        }

        function testMapInit() {
            if (typeof google === 'undefined' || !google.maps) {
                updateResult('mapTestResult', 'Google Maps API not loaded. Please load it first.', 'error');
                return;
            }

            log('Attempting to initialize map...', 'info');

            try {
                mapInstance = new google.maps.Map(document.getElementById('map'), {
                    zoom: 10,
                    center: { lat: 37.7749, lng: -122.4194 }, // San Francisco
                    mapTypeId: 'roadmap'
                });

                // Add a marker
                new google.maps.Marker({
                    position: { lat: 37.7749, lng: -122.4194 },
                    map: mapInstance,
                    title: 'Test Location'
                });

                log('‚úÖ Map initialized successfully!', 'info');
                updateResult('mapTestResult', '‚úÖ Map initialized and marker added!', 'success');

            } catch (error) {
                log(`‚ùå Map initialization failed: ${error.message}`, 'error');
                updateResult('mapTestResult', `‚ùå Map initialization failed: ${error.message}`, 'error');
            }
        }

        // Display environment info
        function displayEnvInfo() {
            const info = [
                `User Agent: ${navigator.userAgent}`,
                `URL: ${window.location.href}`,
                `Protocol: ${window.location.protocol}`,
                `Host: ${window.location.host}`,
                `Language: ${navigator.language}`,
                `Cookie Enabled: ${navigator.cookieEnabled}`,
                `Online: ${navigator.onLine}`
            ];

            document.getElementById('envInfo').innerHTML = info.map(i => `<div>${i}</div>`).join('');
        }

        // Initialize
        displayEnvInfo();
        log('Google Maps API Tester loaded', 'info');
    </script>
</body>

</html>